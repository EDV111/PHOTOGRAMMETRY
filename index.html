<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>3D Model Viewer</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/three@0.131.2/build/three.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@hughsk/async-file@0.1.1/index.min.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/GLTFLoader.js"></script>
		<script src="js/MTLLoader.js"></script>
		<script src="js/OBJLoader.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-md-8 offset-md-2">
					<h1 class="text-center mb-5">3D Model Viewer</h1>
					<div id="progress-bar" class="progress">
						<div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 0%">
						</div>
					</div>
					<div class="d-flex justify-content-center mb-5">
						<input type="file" id="model-input" class="form-control-file" accept=".obj, .gltf, .glb">
						<button id="import-button" class="btn btn-primary ml-3">Import</button>
					</div>
					<div id="viewer-container"></div>
				</div>
			</div>
		</div>

		<script>
			const progressBar = document.getElementById('progress-bar');
			const modelInput = document.getElementById('model-input');
			const importButton = document.getElementById('import-button');
			const viewerContainer = document.getElementById('viewer-container');

			importButton.addEventListener('click', function() {
				modelInput.click();
			});

			modelInput.addEventListener('change', function(event) {
				viewerContainer.innerHTML = '';

				const file = event.target.files[0];
				const extension = file.name.split('.').pop().toLowerCase();

				if (extension === 'obj') {
					const objLoader = new THREE.OBJLoader();
					objLoader.loadAsync(URL.createObjectURL(file), function(object) {
						onLoad(object);
					}, onProgress, onError);
				} else if (extension === 'gltf' || extension === 'glb') {
					const gltfLoader = new THREE.GLTFLoader();
					gltfLoader.loadAsync(URL.createObjectURL(file), function(gltf) {
						onLoad(gltf.scene);
					}, onProgress, onError);
				} else {
					alert('Unsupported file type!');
				}
			});

			function onLoad(object) {
				const scene = new THREE.Scene();
				scene.add(object);

				const camera = new THREE.PerspectiveCamera(45, viewerContainer.offsetWidth / viewerContainer.offsetHeight, 0.1, 1000);
							camera.position.set(0, 0, 10);

			const renderer = new THREE.WebGLRenderer({ antialias: true });
			renderer.setSize(viewerContainer.offsetWidth, viewerContainer.offsetHeight);

			const controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.update();

			viewerContainer.appendChild(renderer.domElement);

			function animate() {
				requestAnimationFrame(animate);
				controls.update();
				renderer.render(scene, camera);
			}
			animate();
		}

		function onProgress(xhr) {
			if (xhr.lengthComputable) {
				const percentComplete = xhr.loaded / xhr.total * 100;
				progressBar.querySelector('.progress-bar').style.width = percentComplete + '%';
			}
		}

		function onError(error) {
			console.log('Error:', error);
		}
	</script>
</body>


